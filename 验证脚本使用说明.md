# N杂质算例验证脚本使用说明

## 📋 **脚本概述**

`verify_N_paths.sh` 是一个全面的验证脚本，用于检查所有117个N杂质算例的存在性和主脚本运行依赖。

## 🚀 **使用方法**

### 在服务器上运行
```bash
cd /path/to/N脚本
./verify_N_paths.sh
```

### 在本地运行（测试）
```bash
cd N脚本
./verify_N_paths.sh
```

## 🔍 **验证内容**

### 1. 基础路径检查
- 验证基础路径是否存在：`/home/task3/xrqliang/solps/SOLPS-ITER-3.0.7-20201205/runs/EAST/81574_D+N`

### 2. 算例路径验证（117个）
- **FAV BT组（42个）**：
  - N 0.5: 9个算例
  - N 1.0: 10个算例
  - N 1.5: 14个算例
  - N 2.0: 9个算例

- **UNFAV BT组（75个）**：
  - N 0.5: 22个算例
  - N 1.0: 22个算例
  - N 1.5: 14个算例
  - N 2.0: 17个算例

### 3. 算例完整性检查
每个算例检查以下必需文件：
- `b2fgmtry` - 几何文件
- `fort.44` - 中性粒子文件
- `b2fstate` - 状态文件
- `b2fplasmf` - 等离子体文件
- `b2.neutrals.parameters` - 中性粒子参数
- `output/` - 输出目录
- `structure.dat` - 结构文件（在算例目录或父目录）

### 4. MATLAB函数依赖检查
- `read_structure.m`
- `read_b2fgmtry.m`
- `read_ft44.m`
- `read_b2fplasmf.m`

### 5. N杂质专用函数检查
- `predefined_case_groups_N.m`
- `advanced_flexible_filtering_N.m`
- `execute_filtering_and_grouping_N.m`
- `get_all_case_data_N.m`
- `filter_cases_N.m`
- `group_cases_N.m`

## 📊 **输出报告**

### 实时进度显示
```
✓ [001/117] fav-N0.5     baseline_na2.8e19_target1_normal_changeto_N0_changeto_N0_changeto_N0p5
✗ [002/117] fav-N0.5     some_missing_case (路径不存在)
```

### 统计信息
```
总算例数: 117 (预期: 117)
存在算例数: 115
缺失算例数: 2
完整算例数: 110
不完整算例数: 5
```

### 按组分类统计
```
FAV BT 组:
  N 0.5: 9 个算例 (预期: 9)
  N 1.0: 10 个算例 (预期: 10)
  ...
```

### 问题报告
- 缺失路径列表
- 不完整算例列表
- 数量不匹配警告

### 主脚本就绪状态
```
✓ 算例路径: 大部分存在 (115/117)
✓ 算例完整性: 大部分完整 (110 个完整算例)
✓ MATLAB读取函数: 全部存在
✓ N杂质专用函数: 核心函数存在
✓ 基础路径: 可访问

就绪评分: 5/5
✅ 主脚本基本就绪，可以尝试运行
```

## 📁 **生成的日志文件**

### 缺失路径日志
- 文件位置：`/tmp/n_missing_paths_[timestamp].txt`
- 内容：所有不存在的算例路径

### 不完整算例日志
- 文件位置：`/tmp/n_incomplete_cases_[timestamp].txt`
- 内容：缺失关键文件的算例及具体缺失文件

## ⚠️ **常见问题**

### 1. 权限问题
```bash
chmod +x verify_N_paths.sh
```

### 2. 路径不存在
- 检查服务器连接
- 确认基础路径正确
- 验证目录权限

### 3. 函数文件缺失
- 确保所有MATLAB函数文件在正确位置
- 检查文件名拼写
- 验证文件权限

### 4. 大量算例缺失
- 可能是路径配置错误
- 检查目录树文件是否最新
- 确认算例是否已迁移

## 🔧 **自定义配置**

### 修改基础路径
编辑脚本中的 `BASE_PATH` 变量：
```bash
BASE_PATH="/your/custom/path/81574_D+N"
```

### 添加新的检查项
在 `check_case_completeness` 函数中添加新的文件检查。

### 修改预期数量
更新脚本中的预期算例数量以匹配实际配置。

## 📈 **性能说明**

- **运行时间**：约2-5分钟（取决于网络和磁盘性能）
- **内存使用**：最小
- **网络要求**：需要访问服务器文件系统

## 🎯 **下一步行动**

### 如果验证通过（评分4-5分）
1. 运行主脚本测试
2. 选择小规模算例进行初步验证
3. 逐步扩大到完整数据集

### 如果验证部分通过（评分2-3分）
1. 修复报告的问题
2. 重新运行验证脚本
3. 确认问题解决后再运行主脚本

### 如果验证失败（评分0-1分）
1. 检查基础环境配置
2. 确认路径和权限设置
3. 联系技术支持解决关键问题

## 📞 **技术支持**

如遇到问题，请提供：
1. 完整的脚本输出
2. 生成的日志文件
3. 服务器环境信息
4. 具体的错误信息

这将帮助快速定位和解决问题。
